Add input verification and negative tests.

GitOrigin-RevId: fc08f110e60132c97f2c985aa173cfbf60af9dd6