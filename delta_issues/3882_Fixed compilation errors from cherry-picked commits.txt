Cherrypicked commits from master caused compilation failures in branch-0.6. This PR fixes it.



